---
import { CreatePost } from '../components/CreatePost'
import { OuRealLogo } from '../components/OuRealLogo'
import { PostsViewer } from '../components/PostsViewer'
import { Terms } from '../components/Terms'
import Layout from '../layouts/Layout.astro'
import { getPosts, Post } from '../utils/supabase'

const posts: Post[] = await getPosts()
---

<Layout title="OuReal. - Entroido">
  <script>
    import type { Images } from '../components/CreatePost'

    const termsAccepted = localStorage.getItem('termsAccepted') === 'true'
    if (!termsAccepted) {
      window.location.href = '/terms'
    } else {
      let lsImages = localStorage.getItem('images')

      if (lsImages) {
        const imagesObj = JSON.parse(lsImages) as Images
        if (!imagesObj.user || !imagesObj.environment) {
          window.location.href = '/new'
        }
      } else {
        window.location.href = '/new'
      }
    }
  </script>

  <OuRealLogo />

  <PostsViewer client:idle posts={posts} />
</Layout>
